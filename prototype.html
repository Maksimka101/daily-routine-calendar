<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Daily Routine Calendar</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –¥—Ä–µ–≤–æ–≤–∏–¥–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã */
    .tree-trunk {
      width: 3px;
      background: linear-gradient(to bottom, #e5e5e5, #d4d4d4);
    }

    .branch-line {
      height: 2px;
      background: #e5e5e5;
    }

    .current-time-line {
      height: 2px;
      background: #ef4444;
      box-shadow: 0 0 8px rgba(239, 68, 68, 0.5);
    }

    /* –ü–æ–∫–∞–∑ –∫–Ω–æ–ø–æ–∫ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
    .mark-item:hover .edit-buttons {
      opacity: 1;
    }

    .tab-item:hover .tab-edit {
      opacity: 1;
    }

    /* –ü–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã */
    .edit-buttons,
    .tab-edit {
      opacity: 0;
      transition: opacity 0.15s ease;
    }

    /* –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö - –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º */
    @media (max-width: 768px) {

      .edit-buttons,
      .tab-edit {
        opacity: 1;
      }
    }

    /* –£–±–∏—Ä–∞–µ–º —Å–∫—Ä–æ–ª–ª–±–∞—Ä –Ω–æ –æ—Å—Ç–∞–≤–ª—è–µ–º —Å–∫—Ä–æ–ª–ª */
    .schedule-scroll {
      scrollbar-width: thin;
      scrollbar-color: #e5e5e5 transparent;
    }
  </style>
</head>

<body class="bg-stone-50 min-h-screen">
  <div id="app" class="max-w-2xl mx-auto px-4 py-8 md:py-16">

    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <header class="text-center mb-8">
      <h1 class="text-2xl font-light text-stone-700 tracking-wide">Daily Routine</h1>
    </header>

    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–Ω–∞ -->
    <div class="flex justify-center gap-8 mb-8 text-sm">
      <label class="flex items-center gap-2 text-stone-500">
        <span>üåô –°–æ–Ω –≤</span>
        <input type="time" v-model="settings.bedtime"
          class="bg-transparent border-b border-stone-300 px-1 py-0.5 text-stone-700 focus:outline-none focus:border-stone-500">
      </label>
      <label class="flex items-center gap-2 text-stone-500">
        <span>‚òÄÔ∏è –ü–æ–¥—ä—ë–º</span>
        <input type="time" v-model="settings.wakeTime"
          class="bg-transparent border-b border-stone-300 px-1 py-0.5 text-stone-700 focus:outline-none focus:border-stone-500">
      </label>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∏ -->
    <div class="flex justify-center gap-1 mb-8">
      <div v-for="(schedule, index) in schedules" :key="schedule.id" class="tab-item relative group">
        <button @click="activeSchedule = index" :class="[
                  'px-4 py-1.5 rounded-full text-sm transition-colors',
                  activeSchedule === index
                    ? 'bg-stone-200 text-stone-700'
                    : 'text-stone-400 hover:text-stone-600'
                ]">
          {{ schedule.name }}
        </button>
        <button v-if="schedules.length > 1" @click="deleteSchedule(index)"
          class="tab-edit absolute -right-1 -top-1 w-4 h-4 bg-stone-300 hover:bg-red-400 text-white rounded-full text-xs flex items-center justify-center">
          √ó
        </button>
      </div>
      <button @click="addSchedule" class="px-3 py-1.5 text-stone-300 hover:text-stone-500 text-sm">
        +
      </button>
    </div>

    <!-- –î—Ä–µ–≤–æ–≤–∏–¥–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ -->
    <div class="relative schedule-scroll">

      <!-- –°—Ç–≤–æ–ª –¥–µ—Ä–µ–≤–∞ -->
      <div class="absolute left-1/2 top-0 bottom-0 tree-trunk -translate-x-1/2"></div>

      <!-- –ö—Ä–∞—Å–Ω–∞—è –ª–∏–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ -->
      <div v-if="currentTimePosition !== null" class="absolute left-0 right-0 current-time-line z-10 flex items-center"
        :style="{ top: currentTimePosition + 'px' }">
        <div class="absolute left-1/2 -translate-x-1/2 -translate-y-1/2 w-2 h-2 bg-red-500 rounded-full"></div>
        <span class="absolute right-0 -translate-y-1/2 text-xs text-red-500 font-medium">
          {{ currentTimeFormatted }}
        </span>
      </div>

      <!-- –ó–∞—Å–µ—á–∫–∏ -->
      <div class="space-y-6 py-4">
        <div v-for="(mark, index) in currentMarks" :key="mark.id" class="mark-item relative"
          :class="index % 2 === 0 ? 'pr-[52%]' : 'pl-[52%]'">

          <!-- –í–µ—Ç–∫–∞ -->
          <div class="absolute top-3 branch-line" :class="index % 2 === 0 ? 'right-1/2 left-4' : 'left-1/2 right-4'">
          </div>

          <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –∑–∞—Å–µ—á–∫–∏ -->
          <div :class="['relative', index % 2 === 0 ? 'text-right' : 'text-left']">

            <!-- –í—Ä–µ–º—è –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ -->
            <div class="flex items-center gap-2" :class="index % 2 === 0 ? 'justify-end' : 'justify-start'">

              <!-- –ö–Ω–æ–ø–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (—Å–ª–µ–≤–∞ –¥–ª—è —á—ë—Ç–Ω—ã—Ö) -->
              <div v-if="index % 2 === 0" class="edit-buttons flex gap-1">
                <button @click="editMark(index)" class="text-stone-300 hover:text-stone-500 text-xs">‚úé</button>
                <button @click="deleteMark(index)" class="text-stone-300 hover:text-red-400 text-xs">√ó</button>
              </div>

              <span class="text-xs text-stone-400 font-mono">{{ mark.time }}</span>
              <span class="text-lg">{{ mark.emoji }}</span>
              <span class="text-sm font-medium text-stone-600">{{ mark.name }}</span>

              <!-- –ö–Ω–æ–ø–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (—Å–ø—Ä–∞–≤–∞ –¥–ª—è –Ω–µ—á—ë—Ç–Ω—ã—Ö) -->
              <div v-if="index % 2 !== 0" class="edit-buttons flex gap-1">
                <button @click="editMark(index)" class="text-stone-300 hover:text-stone-500 text-xs">‚úé</button>
                <button @click="deleteMark(index)" class="text-stone-300 hover:text-red-400 text-xs">√ó</button>
              </div>
            </div>

            <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
            <p v-if="mark.description" class="text-xs text-stone-400 mt-1 max-w-xs"
              :class="index % 2 === 0 ? 'ml-auto' : 'mr-auto'">
              {{ mark.description }}
            </p>
          </div>
        </div>
      </div>

      <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞—Å–µ—á–∫–∏ -->
      <div class="flex justify-center mt-4">
        <button @click="addMark" class="text-stone-300 hover:text-stone-500 text-sm flex items-center gap-1">
          <span>+</span> –¥–æ–±–∞–≤–∏—Ç—å –∑–∞—Å–µ—á–∫—É
        </button>
      </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <div v-if="editingMark !== null" class="fixed inset-0 bg-black/20 flex items-center justify-center z-50"
      @click.self="editingMark = null">
      <div class="bg-white rounded-xl p-6 w-full max-w-sm mx-4 shadow-xl">
        <h3 class="text-lg font-medium text-stone-700 mb-4">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞—Å–µ—á–∫—É</h3>

        <div class="space-y-4">
          <div class="flex gap-3">
            <input v-model="editForm.emoji" class="w-12 text-center text-2xl border border-stone-200 rounded-lg p-2"
              placeholder="üòä">
            <input v-model="editForm.name" class="flex-1 border border-stone-200 rounded-lg px-3 py-2 text-stone-700"
              placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
          </div>

          <div class="flex gap-3">
            <input type="time" v-model="editForm.time"
              class="border border-stone-200 rounded-lg px-3 py-2 text-stone-700">
            <label class="flex items-center gap-2 text-sm text-stone-500">
              <input type="checkbox" v-model="editForm.relative" class="rounded">
              <span>–û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Å–Ω–∞</span>
            </label>
          </div>

          <div v-if="editForm.relative" class="flex gap-2 items-center">
            <input type="number" v-model="editForm.offsetHours"
              class="w-16 border border-stone-200 rounded-lg px-3 py-2 text-stone-700 text-center" placeholder="0">
            <span class="text-stone-500 text-sm">—á. –¥–æ —Å–Ω–∞</span>
          </div>

          <textarea v-model="editForm.description"
            class="w-full border border-stone-200 rounded-lg px-3 py-2 text-stone-700 text-sm" rows="2"
            placeholder="–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"></textarea>
        </div>

        <div class="flex gap-2 mt-6">
          <button @click="editingMark = null" class="flex-1 px-4 py-2 text-stone-500 hover:bg-stone-100 rounded-lg">
            –û—Ç–º–µ–Ω–∞
          </button>
          <button @click="saveMark" class="flex-1 px-4 py-2 bg-stone-700 text-white rounded-lg hover:bg-stone-800">
            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
          </button>
        </div>
      </div>
    </div>

  </div>

  <script>
    const { createApp, ref, computed, watch, onMounted, onUnmounted } = Vue

    createApp({
      setup() {
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
        const settings = ref({
          bedtime: '22:00',
          wakeTime: '07:00'
        })

        // –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–∞—Å–µ—á–∫–∏ (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –≤—Ä–µ–º–µ–Ω–∏ —Å–Ω–∞)
        const defaultMarks = [
          { id: 1, emoji: '‚òÄÔ∏è', name: '–ü–æ–¥—ä—ë–º', time: '', relative: false, offsetHours: 0, description: '–°–æ–Ω 8-9 —á–∞—Å–æ–≤ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è' },
          { id: 2, emoji: 'üç≥', name: '–ó–∞–≤—Ç—Ä–∞–∫', time: '', relative: false, offsetHours: 0, description: '' },
          { id: 3, emoji: '‚òï', name: '–ü–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ—Ñ–µ', time: '', relative: true, offsetHours: 10, description: '–ö–æ—Ñ–µ–∏–Ω –≤—ã–≤–æ–¥–∏—Ç—Å—è ~10 —á–∞—Å–æ–≤' },
          { id: 4, emoji: 'üçΩÔ∏è', name: '–û–±–µ–¥', time: '13:00', relative: false, offsetHours: 0, description: '' },
          { id: 5, emoji: 'üèãÔ∏è', name: '–°–ø–æ—Ä—Ç–∑–∞–ª', time: '', relative: true, offsetHours: 4, description: '–ü–æ–µ—Å—Ç—å —É–≥–ª–µ–≤–æ–¥—ã –∑–∞ 1.5—á –¥–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏' },
          { id: 6, emoji: 'üç≤', name: '–ü–æ—Å–ª–µ–¥–Ω—è—è –µ–¥–∞', time: '', relative: true, offsetHours: 3, description: '–ù–µ –µ—Å—Ç—å –∑–∞ 2-3 —á–∞—Å–∞ –¥–æ —Å–Ω–∞' },
          { id: 7, emoji: 'üìµ', name: '–ë–µ–∑ —ç–∫—Ä–∞–Ω–æ–≤', time: '', relative: true, offsetHours: 1, description: '–°–∏–Ω–∏–π —Å–≤–µ—Ç –º–µ—à–∞–µ—Ç –≤—ã—Ä–∞–±–æ—Ç–∫–µ –º–µ–ª–∞—Ç–æ–Ω–∏–Ω–∞' },
          { id: 8, emoji: 'üõÅ', name: '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–æ —Å–Ω—É', time: '', relative: true, offsetHours: 0.5, description: '–î—É—à, –ø—Ä–∏–≥–ª—É—à–∏—Ç—å —Å–≤–µ—Ç' },
          { id: 9, emoji: 'üåô', name: '–°–æ–Ω', time: '', relative: false, offsetHours: 0, description: '–°–ø–æ–∫–æ–π–Ω–æ–π –Ω–æ—á–∏!' },
        ]

        // –†–∞—Å–ø–∏—Å–∞–Ω–∏—è (–≤–∫–ª–∞–¥–∫–∏)
        const schedules = ref([
          { id: 1, name: '–û–±—ã—á–Ω—ã–π –¥–µ–Ω—å', marks: JSON.parse(JSON.stringify(defaultMarks)) },
        ])

        const activeSchedule = ref(0)

        // –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è
        const currentTime = ref(new Date())
        let timeInterval = null

        onMounted(() => {
          timeInterval = setInterval(() => {
            currentTime.value = new Date()
          }, 60000) // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–∑ –≤ –º–∏–Ω—É—Ç—É
        })

        onUnmounted(() => {
          if (timeInterval) clearInterval(timeInterval)
        })

        // –í—ã—á–∏—Å–ª—è–µ–º—ã–µ –∑–∞—Å–µ—á–∫–∏ —Å —Ä–µ–∞–ª—å–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º
        const currentMarks = computed(() => {
          const marks = schedules.value[activeSchedule.value]?.marks || []
          const bedtime = timeToMinutes(settings.value.bedtime)
          const wakeTime = timeToMinutes(settings.value.wakeTime)

          return marks.map(mark => {
            let time = mark.time

            if (mark.relative) {
              // –í—ã—á–∏—Å–ª—è–µ–º –≤—Ä–µ–º—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Å–Ω–∞
              let minutes = bedtime - (mark.offsetHours * 60)
              if (minutes < 0) minutes += 24 * 60
              time = minutesToTime(minutes)
            } else if (mark.name === '–ü–æ–¥—ä—ë–º' || mark.name === '–ó–∞–≤—Ç—Ä–∞–∫') {
              // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–ª—É—á–∞–∏
              if (mark.name === '–ü–æ–¥—ä—ë–º') {
                time = settings.value.wakeTime
              } else if (mark.name === '–ó–∞–≤—Ç—Ä–∞–∫') {
                time = minutesToTime(wakeTime + 30)
              }
            } else if (mark.name === '–°–æ–Ω') {
              time = settings.value.bedtime
            }

            return { ...mark, time }
          }).sort((a, b) => timeToMinutes(a.time) - timeToMinutes(b.time))
        })

        // –ü–æ–∑–∏—Ü–∏—è –ª–∏–Ω–∏–∏ —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
        const currentTimePosition = computed(() => {
          if (!currentMarks.value.length) return null

          const now = currentTime.value.getHours() * 60 + currentTime.value.getMinutes()
          const marks = currentMarks.value

          const firstMarkTime = timeToMinutes(marks[0].time)
          const lastMarkTime = timeToMinutes(marks[marks.length - 1].time)

          // –ï—Å–ª–∏ —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤–Ω–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –∑–∞—Å–µ—á–µ–∫
          if (now < firstMarkTime || now > lastMarkTime) return null

          // –ù–∞—Ö–æ–¥–∏–º –ø–æ–∑–∏—Ü–∏—é –º–µ–∂–¥—É –∑–∞—Å–µ—á–∫–∞–º–∏
          const totalHeight = marks.length * 64 // –ø—Ä–∏–º–µ—Ä–Ω–∞—è –≤—ã—Å–æ—Ç–∞
          const timeRange = lastMarkTime - firstMarkTime
          const position = ((now - firstMarkTime) / timeRange) * totalHeight + 16

          return position
        })

        const currentTimeFormatted = computed(() => {
          return currentTime.value.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' })
        })

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
        const editingMark = ref(null)
        const editForm = ref({
          emoji: '',
          name: '',
          time: '',
          relative: false,
          offsetHours: 0,
          description: ''
        })

        function editMark(index) {
          const mark = currentMarks.value[index]
          const originalMark = schedules.value[activeSchedule.value].marks.find(m => m.id === mark.id)
          editForm.value = { ...originalMark }
          editingMark.value = mark.id
        }

        function saveMark() {
          const marks = schedules.value[activeSchedule.value].marks
          const index = marks.findIndex(m => m.id === editingMark.value)
          if (index !== -1) {
            marks[index] = { ...editForm.value }
          }
          editingMark.value = null
          saveToStorage()
        }

        function deleteMark(index) {
          const mark = currentMarks.value[index]
          const marks = schedules.value[activeSchedule.value].marks
          const originalIndex = marks.findIndex(m => m.id === mark.id)
          if (originalIndex !== -1) {
            marks.splice(originalIndex, 1)
            saveToStorage()
          }
        }

        function addMark() {
          const marks = schedules.value[activeSchedule.value].marks
          const newId = Math.max(...marks.map(m => m.id), 0) + 1
          editForm.value = {
            id: newId,
            emoji: 'üìå',
            name: '–ù–æ–≤–∞—è –∑–∞—Å–µ—á–∫–∞',
            time: '12:00',
            relative: false,
            offsetHours: 0,
            description: ''
          }
          marks.push({ ...editForm.value })
          editingMark.value = newId
        }

        // –í–∫–ª–∞–¥–∫–∏
        function addSchedule() {
          const newId = Math.max(...schedules.value.map(s => s.id), 0) + 1
          schedules.value.push({
            id: newId,
            name: '–ù–æ–≤–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ',
            marks: JSON.parse(JSON.stringify(defaultMarks))
          })
          activeSchedule.value = schedules.value.length - 1
          saveToStorage()
        }

        function deleteSchedule(index) {
          if (schedules.value.length > 1) {
            schedules.value.splice(index, 1)
            if (activeSchedule.value >= schedules.value.length) {
              activeSchedule.value = schedules.value.length - 1
            }
            saveToStorage()
          }
        }

        // –•–µ–ª–ø–µ—Ä—ã
        function timeToMinutes(time) {
          if (!time) return 0
          const [h, m] = time.split(':').map(Number)
          return h * 60 + m
        }

        function minutesToTime(minutes) {
          const h = Math.floor(minutes / 60) % 24
          const m = minutes % 60
          return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage
        function saveToStorage() {
          localStorage.setItem('dailyRoutine', JSON.stringify({
            settings: settings.value,
            schedules: schedules.value,
            activeSchedule: activeSchedule.value
          }))
        }

        function loadFromStorage() {
          const saved = localStorage.getItem('dailyRoutine')
          if (saved) {
            const data = JSON.parse(saved)
            settings.value = data.settings
            schedules.value = data.schedules
            activeSchedule.value = data.activeSchedule
          }
        }

        // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
        watch([settings, schedules, activeSchedule], saveToStorage, { deep: true })

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        onMounted(loadFromStorage)

        return {
          settings,
          schedules,
          activeSchedule,
          currentMarks,
          currentTime,
          currentTimePosition,
          currentTimeFormatted,
          editingMark,
          editForm,
          editMark,
          saveMark,
          deleteMark,
          addMark,
          addSchedule,
          deleteSchedule
        }
      }
    }).mount('#app')
  </script>
</body>

</html>
